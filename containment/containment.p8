pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
city_w=14 city_h=12 
inf_speed=12 frame=0
city={} zones={} cur_zone={}

function _init()
 px=8 py=8 dx=1 dy=0
 build = false
 gen_city()
end

function gen_city()
 for y=1,city_h do
  for x=1, city_w do
 		block={}
 		block.x=x
 		block.y=y
 		block.pop=100
 		block.inf=max(rnd(100)-99, 0)
	  add(city,block)
  end
 end
end

function update_block(block)
	if frame%inf_speed!=0 then 
	  return
	end
 
 if block.inf > 0 then
  block.pop-=1
  block.inf+=1
  
  if rnd(100) > 5 then
    rd=rnd(4) x=block.x y=block.y
    if rd>3 then
      x+=1
    elseif rd>2 then
      x-=1
    elseif rd>1 then
      y+=1
    else
      y-=1
    end

    nb = get_block(x,y)
    if nb then
      nb.inf=1
    end
  end
 end
end

function get_block(x,y)
  return city[y*city_w+x]
end

function draw_block(block)
 x=block.x*8+3
 y=block.y*8+3
 spr(49,x,y)
 
 inf_spr = 0
 if block.inf > 40 then
  inf_spr=61
 elseif block.inf > 30 then
  inf_spr=60
 elseif block.inf > 20 then
  inf_spr=59
 elseif block.inf > 10 then
  inf_spr=58  
 elseif block.inf > 0 then
  inf_spr=57
 end
 
 if inf_spr > 0 then
  spr(inf_spr,x,y)
 end
end

function _update()
	frame+=1
	
 if px%8==0 and py%8==0 then
  dx=0 dy=0

  if btn(⬅️) then
   dx=-1 dy=0
  elseif btn(➡️) then
   dx=1 dy=0
  elseif btn(⬆️) then
   dy=-1 dx=0
  elseif btn(⬇️) then
   dy=1 dx=0
  end
  
  if not build then
  	cur_zone={}
  else
   pos={px,py}
   add(cur_zone,pos)
  end
 end
  
 px = mid(0,px+dx,124)
 py = mid(0,py+dy,124)
  
 build = btn(❎)
 foreach(city,update_block)
end

function _draw()
 cls()
 rect(1,1,127,127)
  
 ox=3 oy=3
 
 foreach(city,draw_block)
 
	if cur_zone != nil then
  lx=0 ly=0
	 for pos in all(cur_zone) do
   x=pos[1] y=pos[2]

   if lx>0 and ly>0 then
 	  line(lx+2,ly+2,x+2,y+2,8)
 	  line(lx+3,ly+3,x+3,y+3,8) 	  
 	 end

	  lx=x ly=y
	 end

	 if lx>0 and ly>0 then
 	 line(lx+2,ly+2,px+2,py+2,8)
 	 line(lx+3,ly+3,px+3,py+3,8)
 	end
	end
  
 print(px, 5, 112)
 print(py, 5, 120)
  
 if build then
  icon=32
 else
  icon=16
 end
 spr(icon,ox+px-1,oy+py-1)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111000000000000000000000000
0000000005555555555555500333333333333330033333333333333000000000000000001665666115555551133333311cccccc1000000000000000000000000
0070070005111111111111500318811111111130031881111111113000000000000000001665666115588551133333311cccccc1000000000000000000000000
0007700005151515111111500388881111111130038888111111113000000000000000001665555115888851133333311cccccc1000000000000000000000000
0007700005111111111111500388881111111130038888111111113000000000000000001665666115888851133333311cccccc1000000000000000000000000
0070070005111111111111500318811111111130031881111111113000000000000000001665666115588551133333311cccccc1000000000000000000000000
0000000005111111111111500311113333333330031111333333333000000000000000001665666115555551133333311cccccc1000000000000000000000000
00000000051111111111115003111133333333300311113333333330000000000000000011111111111111111111111111111111000000000000000000000000
aa000000051111111111115003111133333333300311113333333330000000000000000011111111111111111111111100000000000000000000000000000000
aa000000051111111111115003111133311111300311113331111130000000000000000016666661155555511333333100000000000000000000000000000000
00000000051111111111115003111133311111300311113331111130000000000000000016666661155555511355553100000000000000000000000000000000
00000000051111111111515003111133311111300311113331111130000000000000000016666661155555511355553100000000000000000000000000000000
00000000051111111555515003111133311111300311113331111130000000000000000016666661155555511355333100000000000000000000000000000000
00000000051111111111115003111133311111300311113331111130000000000000000016666661155555511355333100000000000000000000000000000000
00000000055555555555555003333333333333300333333333333330000000000000000016666661155555511333333100000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111100000000000000000000000000000000
22000000111111110000000000000000000000000000000000000000000000000000000000000000111111110000000000000000000000000000000000000000
22000000155555510555555555555550000000000000000000000000000000000000000000000000155555510000000000000000000000000000000000000000
00000000155885510511111111111150000000000000000000000000000000000000000000000000155555510000000000000000000000000000000000000000
00000000158888510511111111111150000000000000000000000000000000000000000000000000100005510000000000000000000000000000000000000000
00000000158888510511111111111150000000000000000000000000000000000000000000000000100005510000000000000000000000000000000000000000
00000000155885510511111111111150000000000000000000000000000000000000000000000000155005510000000000000000000000000000000000000000
00000000155555510511111111111150000000000000000000000000000000000000000000000000155005510000000000000000000000000000000000000000
00000000111111110511111111111150000000000000000000000000000000000000000000000000111111110000000000000000000000000000000000000000
00000000111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001555555100000000000000000000000000000000000000000000000000000000000000000000000000bb000000bbbb000bbbbbb00000000000000000
00000000155555510000000000000000000000000000000000000000000000000000000000b0000000b0b0000bbbbbb00bbbbbb00bbbbbb00000000000000000
00000000155555510000000000000000000000000000000000000000000000000000000000000b000000bb000bb0bb000bb0bb000bbbbbb00000000000000000
000000001555555100000000000000000000000000000000000000000000000000000000000000000000b00000bbbbb00bbbbbb00bbbbbb00000000000000000
00000000155555510000000000000000000000000000000000000000000000000000000000b0000000bb00000bbbb0b00bbbbbb00bbbbbb00000000000000000
00000000155555510000000000000000000000000000000000000000000000000000000000000000000bb00000bb000000bbbb000bbbbbb00000000000000000
00000000111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000010201020102000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000111211121112010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000010201020102001b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000111211121112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001a1a1a1a1a1a1a1a1a31313131310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001a1a1a1a1a1a1a1a1a1a1a1a31310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001a1a1a0b0b0b0b0b1a1a1a1a31310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001a1a0a0b0b0b0b0c311a1a1a31310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001a1a1a0b0b0b0c0c311a1a1a31310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001a1a1a3131313131311a1a3131310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001305016050190501e05023050280502a0502d0502e05030050300503105031050300502f0502a0502805023050210501d0501d050000001b0501b0500000000000000000000000000000000000000000
